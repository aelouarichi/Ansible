---
- hosts: vmlabsnowazuerh7
  become: yes
  become_method: sudo
 
  tasks:
    - name: Get playbook variables
      include_vars:
        file: vars.yml
    - name: VM_name
      debug:
       msg: "{{ VM_name }}"
    - name: VM_size
      debug:
       msg: "{{ VM_size }}"
    - name: VM_Offer
      debug:
       msg: "{{ Image_offer }}"
       
    - name: Create virtual network
      azure_rm_virtualnetwork:
        resource_group: "{{ RG }}"
        name: testvn001
        address_prefixes: "10.10.0.0/16"
        subscription_id: "{{ subscription_id }}"
        client_id: "{{ Client_id }}"
        secret: "{{ Secret_key }}"
        tenant: "{{ Tenant_id }}"
        
    - name: create virtual machine
      azure_rm_virtualmachine:
        subscription_id: "{{ subscription_id }}"
        client_id: "{{ Client_id }}"
        secret: "{{ Secret_key }}"
        tenant: "{{ Tenant_id }}"
        resource_group: "{{ RG }}"
        name: "{{ VM_name }}"
        vm_size: "{{ VM_size }}"
        admin_username: "{{ admin_uname }}"
        admin_password: "{{ admin_passwd }}"
        image:
          offer: "{{ Image_offer }}"
          publisher: "{{ Image_publisher }}"
          sku: '"{{ Image_sku }}"'
          version: latest
      register: output
    - debug:
       var: output   
      
