---
- hosts: vmlabsnowazuerh7
  become: yes
  become_method: sudo
  vars:
    RG: myResourceGroup
    vm_name: Service Now
    size: Standard_A1
    admin_uname: snow
    admin_passwd: snowteam18!
    azure_client_id: d8394fb2-2b2f-460b-822c-041fa7490ce1
    azure_subscription: 6dd50b23-bc49-47e1-9a77-ce92e911b372
    azure_tenant: 17888fee-4ad7-440a-9af4-bff3d4cd82c6
    azure_secret: 668ef2c6-b418-412c-be43-401ac6e65b14
    


  tasks:
    - name: Add tower Credential for Azure 
      tower_credential:
        name: azure
        kind: azure_rm
        description: azure
        organization: "Default"
        state: present
        client: " {{ azure_client_id }}"
        subscription: " {{ azure_subscription }} "
        tenant: " {{ azure_tenant }}"
        secret: " {{ azure_secret }}"
        #tower_config_file: "~/.tower_cli.cfg"

    - name: Create virtual network
      azure_rm_virtualnetwork:
        resource_group: "{{ RG }}"
        name: testvn001
        address_prefixes: "10.10.0.0/16"
    - name: create virtual machine
      azure_rm_virtualmachine:
        resource_group: "{{ RG }}"
        name: "{{ vm_name }}"
        vm_size: "{{ size }}"
        admin_username: "{{ admin_uname }}"
        admin_password: "{{ admin_passwd }}"
        image:
          offer: CentOS
          publisher: OpenLogic
          sku: '7.1'
          version: latest
